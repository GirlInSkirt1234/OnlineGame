<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Крестики-нолики с комнатами</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2.5rem;
        }
        
        .screen {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        .btn {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(to right, #e74c3c, #c0392b);
        }
        
        .code-display {
            background-color: #f8f9fa;
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 1.8rem;
            font-weight: bold;
            letter-spacing: 5px;
            color: #2c3e50;
        }
        
        .input-field {
            width: 100%;
            padding: 12px 15px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .input-field:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
            margin: 20px auto;
            max-width: 300px;
        }
        
        .cell {
            aspect-ratio: 1;
            background-color: #ecf0f1;
            border: none;
            border-radius: 10px;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .cell:hover {
            background-color: #d6dbdf;
            transform: scale(1.05);
        }
        
        .cell.x {
            color: #e74c3c;
        }
        
        .cell.o {
            color: #3498db;
        }
        
        .status {
            margin: 20px 0;
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
            min-height: 30px;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }
        
        .player {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .player.active {
            background-color: #3498db;
            color: white;
        }
        
        .player.x {
            color: #e74c3c;
        }
        
        .player.o {
            color: #3498db;
        }
        
        .message {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .game-board {
                max-width: 250px;
            }
            
            .cell {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Крестики-нолики</h1>
        
        <!-- Экран выбора -->
        <div id="menu-screen" class="screen active">
            <p>Выберите действие:</p>
            <button id="create-room-btn" class="btn">Создать комнату</button>
            <button id="join-room-btn" class="btn btn-secondary">Присоединиться к комнате</button>
        </div>
        
        <!-- Экран создания комнаты -->
        <div id="create-room-screen" class="screen">
            <p>Ваш код комнаты:</p>
            <div id="room-code" class="code-display">XXXX</div>
            <p>Поделитесь этим кодом с другом</p>
            <div id="waiting-message" class="message">Ожидание второго игрока...</div>
            <button id="cancel-create-btn" class="btn btn-secondary">Отмена</button>
        </div>
        
        <!-- Экран присоединения к комнате -->
        <div id="join-room-screen" class="screen">
            <p>Введите код комнаты:</p>
            <input type="text" id="room-code-input" class="input-field" placeholder="Введите код комнаты" maxlength="4">
            <div id="join-error" class="message error" style="display: none;">Неверный код комнаты</div>
            <button id="join-btn" class="btn">Присоединиться</button>
            <button id="cancel-join-btn" class="btn btn-secondary">Назад</button>
        </div>
        
        <!-- Экран игры -->
        <div id="game-screen" class="screen">
            <div class="player-info">
                <div class="player x" id="player-x">Игрок X: <span id="player-x-name">Вы</span></div>
                <div class="player o" id="player-o">Игрок O: <span id="player-o-name">Соперник</span></div>
            </div>
            
            <div class="status" id="game-status">Ход игрока X</div>
            
            <div class="game-board" id="game-board">
                <button class="cell" data-index="0"></button>
                <button class="cell" data-index="1"></button>
                <button class="cell" data-index="2"></button>
                <button class="cell" data-index="3"></button>
                <button class="cell" data-index="4"></button>
                <button class="cell" data-index="5"></button>
                <button class="cell" data-index="6"></button>
                <button class="cell" data-index="7"></button>
                <button class="cell" data-index="8"></button>
            </div>
            
            <button id="restart-btn" class="btn">Начать заново</button>
            <button id="leave-room-btn" class="btn btn-secondary">Покинуть комнату</button>
        </div>
    </div>

    <script>
        // Элементы DOM
        const screens = {
            menu: document.getElementById('menu-screen'),
            createRoom: document.getElementById('create-room-screen'),
            joinRoom: document.getElementById('join-room-screen'),
            game: document.getElementById('game-screen')
        };
        
        const buttons = {
            createRoom: document.getElementById('create-room-btn'),
            joinRoom: document.getElementById('join-room-btn'),
            cancelCreate: document.getElementById('cancel-create-btn'),
            cancelJoin: document.getElementById('cancel-join-btn'),
            join: document.getElementById('join-btn'),
            restart: document.getElementById('restart-btn'),
            leaveRoom: document.getElementById('leave-room-btn')
        };
        
        const roomCodeDisplay = document.getElementById('room-code');
        const roomCodeInput = document.getElementById('room-code-input');
        const joinError = document.getElementById('join-error');
        const gameStatus = document.getElementById('game-status');
        const gameBoard = document.getElementById('game-board');
        const cells = document.querySelectorAll('.cell');
        const playerXName = document.getElementById('player-x-name');
        const playerOName = document.getElementById('player-o-name');
        const playerX = document.getElementById('player-x');
        const playerO = document.getElementById('player-o');
        const waitingMessage = document.getElementById('waiting-message');
        
        // Состояние игры
        let gameState = {
            currentPlayer: 'X',
            board: ['', '', '', '', '', '', '', '', ''],
            gameActive: false,
            roomCode: '',
            isHost: false,
            playerSymbol: 'X'
        };
        
        // Показать определенный экран
        function showScreen(screen) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screen.classList.add('active');
        }
        
        // Генерация случайного кода комнаты
        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        // Создание комнаты
        buttons.createRoom.addEventListener('click', () => {
            gameState.roomCode = generateRoomCode();
            roomCodeDisplay.textContent = gameState.roomCode;
            gameState.isHost = true;
            gameState.playerSymbol = 'X';
            playerXName.textContent = 'Вы';
            playerOName.textContent = 'Ожидание...';
            showScreen(screens.createRoom);
            
            // В реальном приложении здесь был бы запрос к серверу
            // Имитируем подключение второго игрока через 3 секунды
            setTimeout(() => {
                if (gameState.roomCode) {
                    startGame();
                }
            }, 3000);
        });
        
        // Присоединение к комнате
        buttons.joinRoom.addEventListener('click', () => {
            showScreen(screens.joinRoom);
        });
        
        // Отмена создания комнаты
        buttons.cancelCreate.addEventListener('click', () => {
            gameState.roomCode = '';
            showScreen(screens.menu);
        });
        
        // Отмена присоединения к комнате
        buttons.cancelJoin.addEventListener('click', () => {
            showScreen(screens.menu);
        });
        
        // Попытка присоединения по коду
        buttons.join.addEventListener('click', () => {
            const code = roomCodeInput.value.toUpperCase();
            
            // В реальном приложении здесь была бы проверка на сервере
            // Для демонстрации принимаем любой 4-символьный код
            if (code.length === 4) {
                gameState.roomCode = code;
                gameState.isHost = false;
                gameState.playerSymbol = 'O';
                playerXName.textContent = 'Хост';
                playerOName.textContent = 'Вы';
                startGame();
            } else {
                joinError.style.display = 'block';
            }
        });
        
        // Начало игры
        function startGame() {
            gameState.gameActive = true;
            gameState.currentPlayer = 'X';
            gameState.board = ['', '', '', '', '', '', '', '', ''];
            
            updateGameStatus();
            updatePlayerIndicators();
            showScreen(screens.game);
            
            // В реальном приложении здесь было бы уведомление сервера
            // о начале игры и синхронизация состояния
        }
        
        // Обновление статуса игры
        function updateGameStatus() {
            if (gameState.gameActive) {
                gameStatus.textContent = `Ход игрока ${gameState.currentPlayer}`;
            }
        }
        
        // Обновление индикаторов игроков
        function updatePlayerIndicators() {
            playerX.classList.toggle('active', gameState.currentPlayer === 'X');
            playerO.classList.toggle('active', gameState.currentPlayer === 'O');
        }
        
        // Обработка хода
        function handleCellClick(e) {
            const index = parseInt(e.target.getAttribute('data-index'));
            
            // Проверка возможности хода
            if (gameState.board[index] !== '' || !gameState.gameActive) {
                return;
            }
            
            // В реальном многопользовательском приложении здесь была бы проверка,
            // что ход делает текущий игрок, и отправка хода на сервер
            
            // Для демонстрации позволяем ходить любому игроку в любое время
            makeMove(index, gameState.currentPlayer);
        }
        
        // Совершение хода
        function makeMove(index, player) {
            gameState.board[index] = player;
            cells[index].textContent = player;
            cells[index].classList.add(player.toLowerCase());
            
            // Проверка победы
            if (checkWin()) {
                gameState.gameActive = false;
                gameStatus.textContent = `Игрок ${player} победил!`;
                highlightWinningCells();
                return;
            }
            
            // Проверка ничьи
            if (checkDraw()) {
                gameState.gameActive = false;
                gameStatus.textContent = 'Ничья!';
                return;
            }
            
            // Смена игрока
            gameState.currentPlayer = gameState.currentPlayer === 'X' ? 'O' : 'X';
            updateGameStatus();
            updatePlayerIndicators();
        }
        
        // Проверка победы
        function checkWin() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // горизонтали
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // вертикали
                [0, 4, 8], [2, 4, 6] // диагонали
            ];
            
            return winPatterns.some(pattern => {
                const [a, b, c] = pattern;
                return gameState.board[a] !== '' && 
                       gameState.board[a] === gameState.board[b] && 
                       gameState.board[a] === gameState.board[c];
            });
        }
        
        // Проверка ничьи
        function checkDraw() {
            return gameState.board.every(cell => cell !== '');
        }
        
        // Подсветка выигрышной комбинации
        function highlightWinningCells() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];
            
            const winningPattern = winPatterns.find(pattern => {
                const [a, b, c] = pattern;
                return gameState.board[a] !== '' && 
                       gameState.board[a] === gameState.board[b] && 
                       gameState.board[a] === gameState.board[c];
            });
            
            if (winningPattern) {
                winningPattern.forEach(index => {
                    cells[index].style.backgroundColor = '#2ecc71';
                    cells[index].style.color = 'white';
                });
            }
        }
        
        // Перезапуск игры
        buttons.restart.addEventListener('click', () => {
            resetGame();
            startGame();
        });
        
        // Выход из комнаты
        buttons.leaveRoom.addEventListener('click', () => {
            resetGame();
            showScreen(screens.menu);
        });
        
        // Сброс игры
        function resetGame() {
            gameState.gameActive = false;
            gameState.board = ['', '', '', '', '', '', '', '', ''];
            gameState.currentPlayer = 'X';
            gameState.roomCode = '';
            
            cells.forEach(cell => {
                cell.textContent = '';
                cell.classList.remove('x', 'o');
                cell.style.backgroundColor = '';
                cell.style.color = '';
            });
        }
        
        // Назначение обработчиков событий
        cells.forEach(cell => {
            cell.addEventListener('click', handleCellClick);
        });
        
        // Очистка сообщения об ошибке при вводе кода
        roomCodeInput.addEventListener('input', () => {
            joinError.style.display = 'none';
        });
    </script>
</body>
</html>
